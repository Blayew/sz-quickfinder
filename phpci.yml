build_settings:
  ignore:
    - "*/ext_emconf.php"
    - "*/index.php"
    - "*/typo3"
    - "*/typo3_src"
    - "*/vendor"

setup:
  shell:
    - "/var/www/vhosts/deployment.sunzinet.com/htdocs/set_build_state.sh %PROJECT% %BUILD% %COMMIT% INPROGRESS %PROJECT_TITLE% %BUILD_URI%"

test:
  composer:
    action: "install"
    prefer_dist: true

  PhpLoc:

  php_unit:
    config:
      - "Tests/phpunit.xml"
    path: "Tests"

  php_mess_detector:
    allowed_warnings: -1

  php_code_sniffer:
    standard: "PSR2"
    allowed_warnings: -1

  php_docblock_checker:

success:
  shell:
    - "rm -Rf %BUILD_PATH%/vendor/"
    - "/var/www/vhosts/deployment.sunzinet.com/htdocs/set_build_state.sh %PROJECT% %BUILD% %COMMIT% SUCCESSFUL %PROJECT_TITLE% %BUILD_URI%"

  PackageBuild:
    directory: "/var/www/vhosts/deployment.sunzinet.com/htdocs/builds/%project.title%/%build.branch%/"
    filename: "build-%build.id%"
    allowedBranches: "^master$|^develop$"
    format: tar

failure:
  shell:
    - "/var/www/vhosts/deployment.sunzinet.com/htdocs/set_build_state.sh %PROJECT% %BUILD% %COMMIT% FAILED %PROJECT_TITLE% %BUILD_URI%"

  email:
    committer: true
